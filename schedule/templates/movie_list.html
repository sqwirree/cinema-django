{% extends 'base.html' %}
{% block title %}–°–ø–∏—Å–æ–∫ —Ñ—ñ–ª—å–º—ñ–≤{% endblock %}

{% block extra_css %}
<style>
/* üåå –û–±—ë—Ä—Ç–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–ø–∏—Å–∫–∞ —Ñ–∏–ª—å–º–æ–≤ */
.movies-page {
  position: relative;
  max-width: 1100px;
  margin: 0 auto;
  padding: 20px 0 40px 0;
  z-index: 2;
}

/* üåå –§–æ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π) */
body {
  background: radial-gradient(circle at center, #000000 0%, #040404 50%, #0a0a0a 100%);
  background-color: #080808;
  background-image: url('https://www.transparenttextures.com/patterns/dark-mosaic.png');
  min-height: 100vh;
  color: #fff;
}

/* üåë –ù–∞–ø—ñ–≤–ø—Ä–æ–∑–æ—Ä–∏–π —à–∞—Ä –¥–ª—è –∑–∞—Ç–µ–º–Ω–µ–Ω–Ω—è —Ñ–æ–Ω—É */
#background-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0);
  backdrop-filter: blur(1px);
  pointer-events: none;
  transition: background 0.6s ease;
  z-index: 1;
}
#background-overlay.active {
  background: rgba(0, 0, 0, 0.55);
  backdrop-filter: blur(3px);
}

/* üí° –û—Å–Ω–æ–≤–Ω–∏–π –ª—ñ—Ö—Ç–∞—Ä */
#spotlight,
.moving-light {
  position: fixed;
  border-radius: 50%;
  pointer-events: none;
  mix-blend-mode: screen;
  transition: all 0.4s ease;
  z-index: 0;
}
#spotlight {
  width: 500px;
  height: 500px;
  background: radial-gradient(
    circle,
    rgba(255, 255, 210, 0.15) 0%,
    rgba(255, 255, 180, 0.08) 30%,
    rgba(0, 0, 0, 0.95) 100%
  );
  filter: blur(8px);
}
#spotlight.active {
  background: radial-gradient(
    circle,
    rgba(255, 255, 220, 0.35) 0%,
    rgba(255, 255, 180, 0.18) 40%,
    rgba(0, 0, 0, 0.8) 100%
  );
  filter: blur(3px);
}
.moving-light {
  filter: blur(12px);
  opacity: 0.35;
}
.moving-light.active {
  transform: scale(1.4);
  opacity: 0.7;
  filter: blur(5px);
}

/* üî¶ –ó–∞—Ç–µ–º–Ω–µ–Ω–Ω—è —ñ–Ω—à–∏—Ö —Ñ—ñ–ª—å–º—ñ–≤ */
.dimmed {
  filter: brightness(0.18);
  transition: filter 0.5s ease;
}

/* üé¨ –ó–∞–≥–æ–ª–æ–≤–∫–∏ */
.movies-title {
  text-align: center;
  color: #FFD700;
  margin-bottom: 40px;
  font-size: 2.6rem;
  letter-spacing: 1.2px;
  text-shadow:
    0 0 8px rgba(255, 215, 0, 0.6),
    0 0 25px rgba(255, 50, 0, 0.25);
}
.movies-title.second {
  margin-top: 40px;
}

/* üéû –ö–∞—Ä—Ç–∫–∏ —Ñ—ñ–ª—å–º—ñ–≤ */
.movie {
  background: rgba(12, 12, 12, 0.9);
  border-radius: 16px;
  padding: 22px;
  margin: 25px auto;
  max-width: 860px;
  display: flex;
  align-items: center;
  gap: 22px;
  box-shadow:
    0 0 12px rgba(0, 0, 0, 0.7),
    0 0 25px rgba(255, 0, 0, 0.08);
  transition: all 0.35s ease;
  border: 1px solid rgba(255, 255, 255, 0.06);
  position: relative;
  z-index: 3;
}
.movie:hover {
  transform: translateY(-6px) scale(1.01);
  box-shadow:
    0 0 25px rgba(255, 215, 0, 0.15),
    0 0 60px rgba(255, 50, 50, 0.25);
  background: rgba(20, 20, 20, 0.95);
}
.movie img {
  max-width: 150px;
  border-radius: 12px;
  box-shadow: 0 0 15px rgba(0,0,0,0.7);
}
.movie-content {
  flex: 1;
}
.movie h2 {
  color: #ff3b3b;
  margin-bottom: 10px;
  font-size: 1.7rem;
  text-shadow: 0 0 6px rgba(255, 60, 60, 0.3);
}
.movie p {
  margin: 6px 0;
  line-height: 1.5;
  color: #ddd;
  font-size: 1rem;
}
.movie a {
  display: inline-block;
  margin-top: 14px;
  padding: 10px 20px;
  background: linear-gradient(90deg, #e50914, #ff3b3b);
  color: white;
  text-decoration: none;
  border-radius: 8px;
  font-weight: bold;
  font-size: 1rem;
  transition: all 0.3s ease;
  box-shadow:
    0 0 12px rgba(229,9,20,0.35),
    inset 0 0 10px rgba(255,255,255,0.15);
}
.movie a:hover {
  background: linear-gradient(90deg, #ff1a24, #ff6a4a);
  box-shadow:
    0 0 20px rgba(255, 80, 80, 0.5),
    inset 0 0 10px rgba(255,255,255,0.25);
}

/* üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó */
.recommendations-container {
  display: flex;
  gap: 24px;
  overflow-x: auto;
  padding: 25px 10px 35px;
  scroll-behavior: smooth;
}
.recommendations-container::-webkit-scrollbar {
  height: 8px;
}
.recommendations-container::-webkit-scrollbar-thumb {
  background: rgba(255, 215, 0, 0.35);
  border-radius: 4px;
}
.recommendation-card {
  background: linear-gradient(180deg, rgba(18,18,18,0.95), rgba(8,8,8,0.9));
  border-radius: 16px;
  border: 1px solid rgba(255, 215, 0, 0.2);
  flex: 0 0 280px;
  box-shadow:
    0 0 20px rgba(255, 0, 0, 0.15),
    inset 0 0 15px rgba(255,255,255,0.03);
  transition: all 0.35s ease;
  position: relative;
  z-index: 3;
}
.recommendation-card:hover {
  transform: translateY(-8px);
  box-shadow:
    0 0 25px rgba(255, 215, 0, 0.3),
    0 0 60px rgba(255, 0, 0, 0.25);
  border-color: rgba(255, 215, 0, 0.5);
}
.recommendation-card img {
  width: 100%;
  height: 180px;
  object-fit: cover;
  border-top-left-radius: 16px;
  border-top-right-radius: 16px;
  filter: brightness(0.85);
  transition: filter 0.3s ease;
}
.recommendation-card:hover img {
  filter: brightness(1);
}
.recommendation-content {
  padding: 18px 15px 20px;
}
.recommendation-content h3 {
  color: #ff4040;
  font-size: 1.25rem;
  margin-bottom: 8px;
  text-shadow: 0 0 6px rgba(255, 60, 60, 0.3);
}
.recommendation-content p {
  font-size: 0.95rem;
  color: #ccc;
  line-height: 1.5;
  margin-bottom: 8px;
}
.recommendation-content a {
  display: inline-block;
  margin-top: 8px;
  padding: 8px 14px;
  border-radius: 6px;
  background: linear-gradient(90deg, #e50914, #ff3b3b);
  color: #fff;
  font-weight: bold;
  font-size: 0.95rem;
  text-decoration: none;
  transition: all 0.3s ease;
  box-shadow:
    0 0 8px rgba(229,9,20,0.3),
    inset 0 0 6px rgba(255,255,255,0.15);
}
.recommendation-content a:hover {
  background: linear-gradient(90deg, #ff1a24, #ff6a4a);
  box-shadow:
    0 0 14px rgba(255, 80, 80, 0.45),
    inset 0 0 10px rgba(255,255,255,0.25);
}

/* üë§ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è */
.auth {
  text-align: center;
  margin: 40px 0 10px;
  font-size: 1.05rem;
}
.auth a {
  color: #FFD700;
  text-decoration: none;
  margin: 0 12px;
  font-weight: bold;
  transition: 0.3s;
}
.auth a:hover {
  color: #fff;
  text-shadow: 0 0 10px #FFD700;
}

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ üì± –ê–î–ê–ü–¢–ò–í ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */

/* –¢–µ–ª–µ—Ñ–æ–Ω–∏ */
@media (max-width: 600px) {
  .movies-page {
    padding: 10px 0 30px 0;
  }

  .movies-title {
    font-size: 1.8rem;
    margin-bottom: 24px;
  }

  .movie {
    flex-direction: column;
    align-items: flex-start;
    padding: 16px;
    margin: 16px auto;
    gap: 14px;
  }

  .movie img {
    max-width: 100%;
    width: 100%;
  }

  .movie h2 {
    font-size: 1.4rem;
  }

  .movie p {
    font-size: 0.95rem;
  }

  .movie a {
    width: 100%;
    text-align: center;
  }

  .recommendations-container {
    gap: 16px;
    padding: 18px 4px 26px;
    scroll-snap-type: x mandatory;
  }

  .recommendation-card {
    flex: 0 0 230px;
    scroll-snap-align: start;
  }

  .recommendation-card img {
    height: 150px;
  }

  .auth {
    font-size: 0.95rem;
    margin-top: 30px;
  }
}

/* –ü–ª–∞–Ω—à–µ—Ç—ã */
@media (min-width: 601px) and (max-width: 991px) {
  .movies-page {
    max-width: 95%;
  }

  .movies-title {
    font-size: 2.2rem;
  }

  .movie {
    max-width: 100%;
  }

  .recommendations-container {
    padding-left: 6px;
    padding-right: 6px;
  }
}

/* –î–µ—Å–∫—Ç–æ–ø—ã */
@media (min-width: 992px) {
  .movies-page {
    max-width: 1100px;
  }
}
</style>
{% endblock %}

{% block content %}
<!-- üåë –¢–µ–º–Ω–µ –∑–∞—Ç–µ–º–Ω–µ–Ω–Ω—è -->
<div id="background-overlay"></div>

<!-- üí° –û—Å–Ω–æ–≤–Ω–∏–π –ª—ñ—Ö—Ç–∞—Ä -->
<div id="spotlight"></div>
<div id="extra-lights"></div>

<div class="movies-page">
  <h1 class="movies-title">–î–æ—Å—Ç—É–ø–Ω—ñ —Ñ—ñ–ª—å–º–∏</h1>

  {% if recommendations %}
    <h2 style="text-align:center; color:#FFD700; margin-top:30px;">üéØ –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ –¥–ª—è –≤–∞—Å</h2>
    <div class="recommendations-container">
      {% for movie in recommendations %}
      <div class="recommendation-card">
        {% if movie.image %}
          <img src="{{ movie.image.url }}" alt="{{ movie.title }}">
        {% else %}
          <img src="https://via.placeholder.com/300x180?text=No+Image" alt="No Image">
        {% endif %}
        <div class="recommendation-content">
          <h3>{{ movie.title }}</h3>
          <p>{{ movie.short_description|truncatewords:15 }}</p>
          <p><strong>–ñ–∞–Ω—Ä–∏:</strong> {{ movie.genres.all|join:", " }}</p>
          <p><strong>–†—ñ–∫:</strong> {{ movie.release_year }}</p>
          <a href="{% url 'film_description' movie.id %}">‚ÑπÔ∏è –î–æ–∫–ª–∞–¥–Ω—ñ—à–µ</a>
        </div>
      </div>
      {% endfor %}
    </div>
    <hr style="margin: 40px 0; border-color: #FFD700;">
  {% endif %}

  <h1 class="movies-title second">–§—ñ–ª—å–º–∏ –≤ –ø—Ä–æ–∫–∞—Ç—ñ</h1>
  {% for movie in movies %}
    <div class="movie">
      {% if movie.image %}
        <img src="{{ movie.image.url }}" alt="{{ movie.title }}">
      {% else %}
        <img src="https://via.placeholder.com/150?text=No+Image" alt="No Image Available">
      {% endif %}
      <div class="movie-content">
        <h2>{{ movie.title }}</h2>
        <p>{{ movie.short_description }}</p>
        <p><strong>–ñ–∞–Ω—Ä–∏:</strong> {{ movie.genres.all|join:", " }}</p>
        <p><strong>–†—ñ–∫ –≤–∏–ø—É—Å–∫—É:</strong> {{ movie.release_year }}</p>
        <a href="{% url 'film_description' movie.id %}">‚ÑπÔ∏è –î–æ–∫–ª–∞–¥–Ω—ñ—à–µ</a>
      </div>
    </div>
  {% endfor %}

  <div class="auth">
    {% if user.is_authenticated %}
      <p>–õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ, <strong>{{ user.first_name }} {{ user.last_name }}</strong>!
      <a href="{% url 'logout' %}">–í–∏–π—Ç–∏</a></p>
    {% else %}
      <p><a href="{% url 'login' %}">–£–≤—ñ–π—Ç–∏</a> –∞–±–æ <a href="{% url 'register' %}">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</a></p>
    {% endif %}
  </div>
</div>

<script>
/* üåï –°–≤—ñ—Ç–ª–æ–≤—ñ –µ—Ñ–µ–∫—Ç–∏ (–∫–∞–∫ —É —Ç–µ–±—è) */
const spotlight = document.getElementById("spotlight");
const overlay = document.getElementById("background-overlay");
let x = 100, y = 200, dirX = 2, dirY = 1.5, hovering = false, mouseX = 0, mouseY = 0, time = 0;

function lerp(a,b,t){return a+(b-a)*t;}

function animateLight(){
  time += 0.02;
  if(!hovering){
    x += dirX; y += dirY;
    if(x < 0 || x > window.innerWidth - 500) dirX *= -1;
    if(y < 0 || y > window.innerHeight - 500) dirY *= -1;
  } else {
    const swayX = Math.sin(time*3)*10;
    const swayY = Math.cos(time*2)*10;
    x = lerp(x, mouseX - 250 + swayX, 0.08);
    y = lerp(y, mouseY - 250 + swayY, 0.08);
  }
  spotlight.style.left = x + "px";
  spotlight.style.top = y + "px";
  requestAnimationFrame(animateLight);
}
animateLight();

const extraContainer = document.getElementById("extra-lights");
const lights = [];
const colors = [
  "rgba(255,255,200,0.25)",
  "rgba(255,200,150,0.18)",
  "rgba(255,255,180,0.20)",
  "rgba(200,255,255,0.15)",
  "rgba(255,220,255,0.17)"
];
const sizes = [400,500,600,450,550];
const speeds = [1.2,1.8,2.3,1.6,2.1];

for(let i=0;i<5;i++){
  const el = document.createElement("div");
  el.className = "moving-light";
  el.style.width = sizes[i]+"px";
  el.style.height = sizes[i]+"px";
  el.style.background = `radial-gradient(circle, ${colors[i]} 0%, rgba(0,0,0,0.9) 90%)`;
  extraContainer.appendChild(el);
  lights.push({
    el,
    x: Math.random()*(window.innerWidth - sizes[i]),
    y: Math.random()*(window.innerHeight - sizes[i]),
    dx: (Math.random()-0.5)*speeds[i]*2,
    dy: (Math.random()-0.5)*speeds[i]*2,
    size: sizes[i],
    offset: Math.random()*Math.PI*2
  });
}

function animateExtra(){
  time += 0.015;
  lights.forEach((l,i)=>{
    if(!hovering){
      l.x += l.dx;
      l.y += l.dy;
      if(l.x < 0 || l.x > window.innerWidth - l.size) l.dx *= -1;
      if(l.y < 0 || l.y > window.innerHeight - l.size) l.dy *= -1;
    } else {
      const radius = 100 + Math.sin(time*1.5 + i)*20;
      const swayX = Math.sin(time*2 + l.offset)*25;
      const swayY = Math.cos(time*2 + l.offset)*25;
      const targetX = mouseX - l.size/2 + Math.cos(i*1.25 + time)*radius + swayX;
      const targetY = mouseY - l.size/2 + Math.sin(i*1.3 + time)*radius + swayY;
      l.x = lerp(l.x, targetX, 0.07);
      l.y = lerp(l.y, targetY, 0.07);
    }
    l.el.style.left = l.x + "px";
    l.el.style.top = l.y + "px";
  });
  requestAnimationFrame(animateExtra);
}
animateExtra();

function attachLightEffect(elements){
  elements.forEach(el=>{
    el.addEventListener("mouseenter",()=>{
      hovering = true;
      spotlight.classList.add("active");
      overlay.classList.add("active");
      lights.forEach(l=>l.el.classList.add("active"));
      document.querySelectorAll(".movie,.recommendation-card").forEach(m=>{
        if(m!==el)m.classList.add("dimmed");
      });
    });
    el.addEventListener("mousemove",e=>{
      mouseX = e.clientX;
      mouseY = e.clientY;
    });
    el.addEventListener("mouseleave",()=>{
      hovering = false;
      spotlight.classList.remove("active");
      overlay.classList.remove("active");
      lights.forEach(l=>l.el.classList.remove("active"));
      document.querySelectorAll(".movie,.recommendation-card").forEach(m=>m.classList.remove("dimmed"));
    });
  });
}
attachLightEffect(document.querySelectorAll(".movie"));
attachLightEffect(document.querySelectorAll(".recommendation-card"));
</script>
{% endblock %}
